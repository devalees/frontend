
> frontend@1.0.0 test
> vitest run --reporter=verbose src/tests/performance/componentSplitting.test.tsx

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v1.6.1 /home/ehab/Desktop/frontend

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Component Loading > should lazy load component when needed
[TEST] Setting up test with cleared mocks
[TEST] Running test: should lazy load component when needed
[TEST] Performance spy initialized
[TEST] Starting component loading with act()
[TEST] mockLoadComponent implementation executing

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Component Loading > should lazy load component when needed
[TEST] mockLoadComponent returning TestComponent
[TEST] Component loading completed
[TEST] Checking performance marks
[TEST] Verifying loadComponent was called with correct ID
[TEST] Test completed, current mock state: {
  loadComponent: 1,
  preloadComponent: 0,
  registerComponent: 0,
  lazyLoadComponent: 0,
  errorBoundary: 0,
  getComponent: 0
}

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Component Loading > should measure component render performance
[TEST] Setting up test with cleared mocks
[TEST] Running test: should measure component render performance
[TEST] Performance spy initialized for render metrics
[TEST] Starting component loading with act() for render test
[TEST] mockLoadComponent implementation executing with render metrics

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Component Loading > should measure component render performance
[TEST] mockLoadComponent returning TestComponent with render metrics
[TEST] Component loading and render test completed
[TEST] Checking render performance marks
[TEST] Test completed, current mock state: {
  loadComponent: 1,
  preloadComponent: 0,
  registerComponent: 0,
  lazyLoadComponent: 0,
  errorBoundary: 0,
  getComponent: 0
}

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should preload component on demand
[TEST] Setting up test with cleared mocks
[TEST] Running test: should preload component on demand
[TEST] Performance spy initialized for preload test
[TEST] Starting component preloading with act()
[TEST] mockPreloadComponent implementation executing

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should preload component on demand
[TEST] mockPreloadComponent completed
[TEST] Component preloading completed
[TEST] Verifying preload calls and performance
[TEST] Test completed, current mock state: {
  loadComponent: 0,
  preloadComponent: 1,
  registerComponent: 0,
  lazyLoadComponent: 0,
  errorBoundary: 0,
  getComponent: 0
}

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should register component for optimal loading
[TEST] Setting up test with cleared mocks
[TEST] Running test: should register component for optimal loading
[TEST] mockRegisterComponent setup to return mockComponent
[TEST] Calling registerComponent
[TEST] registerComponent call completed
[TEST] Verifying register calls and result
[TEST] Test completed, current mock state: {
  loadComponent: 0,
  preloadComponent: 0,
  registerComponent: 1,
  lazyLoadComponent: 0,
  errorBoundary: 0,
  getComponent: 0
}

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should track component dependency loading times
[TEST] Setting up test with cleared mocks
[TEST] Running test: should track component dependency loading times
[TEST] Performance spy initialized for dependency test
[TEST] Starting component loading with dependencies
[TEST] mockLoadComponent implementation executing for dependency test

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should track component dependency loading times
[TEST] mockLoadComponent returning TestComponent with dependency metrics
[TEST] Component loading with dependencies completed
[TEST] Verifying dependency loading performance
[TEST] Test completed, current mock state: {
  loadComponent: 1,
  preloadComponent: 0,
  registerComponent: 0,
  lazyLoadComponent: 0,
  errorBoundary: 0,
  getComponent: 0
}

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should handle component loading errors gracefully
[TEST] Setting up test with cleared mocks
[TEST] Running test: should handle component loading errors gracefully
[TEST] Performance spy initialized for error test
[TEST] Directly rendering error boundary with error component
[TEST] Test completed, current mock state: {
  loadComponent: 0,
  preloadComponent: 0,
  registerComponent: 0,
  lazyLoadComponent: 0,
  errorBoundary: 0,
  getComponent: 0
}

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should provide detailed error information with componentId
[TEST] Setting up test with cleared mocks
[TEST] Running test: should provide detailed error information
[TEST] Performance spy initialized for detailed error test
[TEST] Rendering ComponentErrorBoundary with detailed error
[TEST] Error caught in mock getDerivedStateFromError: Failed to load component
[TEST] Error caught in mock getDerivedStateFromError: Failed to load component
[TEST] Error caught in mock componentDidCatch: Failed to load component
[TEST] Added componentId test-component to error
[TEST] Test completed, current mock state: {
  loadComponent: 0,
  preloadComponent: 0,
  registerComponent: 0,
  lazyLoadComponent: 0,
  errorBoundary: 1,
  getComponent: 0
}

stderr | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should provide detailed error information with componentId
Error: Uncaught [Error: Failed to load component]
    at reportException (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:27451:7)
    at performUnitOfWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:26560:12) Error: Failed to load component
    at ComponentWithComponentId (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:421:15)
    at renderWithHooks (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:16305:18)
    at mountIndeterminateComponent (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:20074:13)
    at beginWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:21587:16)
    at HTMLUnknownElement.callCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
Error: Uncaught [Error: Failed to load component]
    at reportException (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:27451:7)
    at performUnitOfWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:26560:12) Error: Failed to load component
    at ComponentWithComponentId (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:421:15)
    at renderWithHooks (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:16305:18)
    at mountIndeterminateComponent (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:20074:13)
    at beginWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:21587:16)
    at HTMLUnknownElement.callCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
The above error occurred in the <ComponentWithComponentId> component:

    at ComponentWithComponentId (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:366:25)
    at TestErrorBoundary (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:69:5)

React will try to recreate this component tree from scratch using the error boundary you provided, TestErrorBoundary.

stdout | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should allow retry of failed component loading
[TEST] Setting up test with cleared mocks
[TEST] Running test: should allow retry of failed component loading
[TEST] Performance spy initialized for retry test
[TEST] Rendering test error boundary with retry wrapper
[TEST] Error caught in mock getDerivedStateFromError: Failed to load component
[TEST] Error caught in mock getDerivedStateFromError: Failed to load component
[TEST] Error caught in mock componentDidCatch: Failed to load component
[TEST] Added componentId retry-test to error
[TEST] Test completed, current mock state: {
  loadComponent: 0,
  preloadComponent: 0,
  registerComponent: 0,
  lazyLoadComponent: 0,
  errorBoundary: 1,
  getComponent: 0
}

stderr | src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should allow retry of failed component loading
Error: Uncaught [Error: Failed to load component]
    at reportException (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:27451:7)
    at performUnitOfWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:26560:12) Error: Failed to load component
    at RetryTestWrapper (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:473:17)
    at renderWithHooks (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:16305:18)
    at mountIndeterminateComponent (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:20074:13)
    at beginWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:21587:16)
    at HTMLUnknownElement.callCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
Error: Uncaught [Error: Failed to load component]
    at reportException (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:353:9)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
    at HTMLUnknownElement.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
    at Object.invokeGuardedCallbackDev (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
    at invokeGuardedCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
    at beginWork$1 (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:27451:7)
    at performUnitOfWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:26560:12) Error: Failed to load component
    at RetryTestWrapper (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:473:17)
    at renderWithHooks (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:16305:18)
    at mountIndeterminateComponent (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:20074:13)
    at beginWork (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:21587:16)
    at HTMLUnknownElement.callCallback (/home/ehab/Desktop/frontend/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
    at innerInvokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
    at invokeEventListeners (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
    at HTMLUnknownElementImpl._dispatch (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
    at HTMLUnknownElementImpl.dispatchEvent (/home/ehab/Desktop/frontend/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
The above error occurred in the <RetryTestWrapper> component:

    at RetryTestWrapper (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:406:71)
    at TestErrorBoundary (/home/ehab/Desktop/frontend/src/tests/performance/componentSplitting.test.tsx:69:5)

React will try to recreate this component tree from scratch using the error boundary you provided, TestErrorBoundary.

 ✓ src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Component Loading > should lazy load component when needed
 ✓ src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Component Loading > should measure component render performance
 ✓ src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should preload component on demand
 ✓ src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should register component for optimal loading
 ✓ src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Lazy Loading > should track component dependency loading times
 × src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should handle component loading errors gracefully
   → Failed to load component
 × src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should provide detailed error information with componentId
   → waitFor is not a function
 × src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should allow retry of failed component loading
   → waitFor is not a function

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 3 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should handle component loading errors gracefully
Error: Failed to load component
 ❯ src/tests/performance/componentSplitting.test.tsx:379:25
    377|       
    378|       // Arrange: Prepare the error
    379|       const testError = new Error('Failed to load component');
       |                         ^
    380|       
    381|       // Act - Render a direct implementation of error boundary with e…

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/3]⎯

 FAIL  src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should provide detailed error information with componentId
TypeError: waitFor is not a function
 ❯ waitForErrorBoundary src/tests/performance/componentSplitting.test.tsx:147:9
    145| // Special helper to wait for error boundary to catch errors
    146| const waitForErrorBoundary = async (getByTestId: any) => {
    147|   await waitFor(() => {
       |         ^
    148|     expect(getByTestId('error-boundary')).toBeInTheDocument();
    149|   }, { timeout: 1000 });
 ❯ src/tests/performance/componentSplitting.test.tsx:436:13

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/3]⎯

 FAIL  src/tests/performance/componentSplitting.test.tsx > Component-based Code Splitting > Error Boundaries > should allow retry of failed component loading
TypeError: waitFor is not a function
 ❯ waitForErrorBoundary src/tests/performance/componentSplitting.test.tsx:147:9
    145| // Special helper to wait for error boundary to catch errors
    146| const waitForErrorBoundary = async (getByTestId: any) => {
    147|   await waitFor(() => {
       |         ^
    148|     expect(getByTestId('error-boundary')).toBeInTheDocument();
    149|   }, { timeout: 1000 });
 ❯ src/tests/performance/componentSplitting.test.tsx:492:13

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/3]⎯

 Test Files  1 failed (1)
      Tests  3 failed | 5 passed (8)
   Start at  22:09:42
   Duration  1.94s (transform 340ms, setup 481ms, collect 288ms, tests 112ms, environment 499ms, prepare 141ms)

